import { Injectable, NotFoundException } from '@nestjs/common';
import { PrismaService } from 'src/prisma.service';

@Injectable()
export class UsuarioService {
  constructor(private readonly prisma: PrismaService) {}

  async obtenerUsuarios() {
    return await this.prisma.$queryRaw<
      Array<{ id_emp: number; nombre: string; e_mail: string; rol: string }>
    >`
      SELECT e.id_emp, e.nombre, e.e_mail, r.nombre AS rol
      FROM gescur.emp_nomina e
      INNER JOIN gescur.roles r ON e.publico = r.id
    `;
  }

  async iniciarSesion(id_emp: number) {
    const usuarios = await this.prisma.$queryRaw<
      Array<{ id_emp: number; nombre: string; e_mail: string; rol: string }>
    >`
      SELECT e.id_emp, e.nombre, e.e_mail, r.nombre AS rol
      FROM gescur.emp_nomina e
      INNER JOIN gescur.roles r ON e.publico = r.id
      WHERE e.id_emp = ${id_emp}
    `;

    if (!usuarios || usuarios.length === 0) {
      throw new NotFoundException('Usuario no encontrado');
    }

    return usuarios[0]; // Retornar solo el primer resultado
  }
}
