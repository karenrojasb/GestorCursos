import { Injectable } from '@nestjs/common';
import { PrismaService } from '../prisma.service';

@Injectable()
export class UsuarioService {
  constructor(private prisma: PrismaService) {}

  async validarUsuario(id_emp: string) {
    const usuario = await this.prisma.emp_nomina.findUnique({
      where: { id_emp },
      select: { id_emp: true, nombre: true, publico: true, email: true },
    });

    if (!usuario) {
      throw new Error('El usuario no existe');
    }

    // Verificar si el usuario es administrador en gescur.rol_usuario
    const esAdmin = await this.prisma.rol_usuario.findFirst({
      where: { usuario: usuario.email, id_rol: 1 }, // Busca el email en la tabla rol_usuario
    });

    return {
      id_emp: usuario.id_emp,
      nombre: usuario.nombre,
      publico: usuario.publico, // 1 = profesor, 2 = administrativo
      esAdministrador: !!esAdmin, // true si est√° en rol_usuario con id_rol = 1
    };
  }
}