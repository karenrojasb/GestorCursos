import React, { useEffect, useState } from "react";

interface Profesor {
  id_emp: number;
  nombre: string;
}

interface CursoEditarModalProps {
  curso: {
    id: number;
    Profesor: number | null;
  };
  onClose: () => void;
  onSave: () => void;
}

const CursoEditarModal: React.FC<CursoEditarModalProps> = ({ curso, onClose, onSave }) => {
  const [profesores, setProfesores] = useState<Profesor[]>([]);
  const [profesorSeleccionado, setProfesorSeleccionado] = useState<number | null>(curso.Profesor);

  useEffect(() => {
    const cargarProfesores = async () => {
      try {
        const res = await fetch("http://localhost/api/cursos/profe");
        const data = await res.json();
        setProfesores(data);
      } catch (error) {
        console.error("Error al cargar profesores:", error);
      }
    };

    cargarProfesores();
  }, []);

  const handleGuardar = async () => {
    const dataToSend = {
      Profesor: profesorSeleccionado,
    };

    try {
      const res = await fetch(`http://localhost/api/cursos/${curso.id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(dataToSend),
      });

      if (!res.ok) {
        const errorText = await res.text();
        console.error("Error en el servidor:", errorText);
        alert("No se pudo actualizar el curso");
        return;
      }

      onSave();
      onClose();
    } catch (error) {
      console.error("Error al guardar curso:", error);
      alert("Ocurri√≥ un error al actualizar el curso");
    }
  };

  return (
    <div className="modal">
      <h2>Editar Profesor del Curso</h2>

      <label>Profesor</label>
      <select
        value={profesorSeleccionado ?? ""}
        onChange={(e) => setProfesorSeleccionado(Number(e.target.value))}
      >
        <option value="">Selecciona un profesor</option>
        {profesores.map((prof) => (
          <option key={prof.id_emp} value={prof.id_emp}>
            {prof.nombre}
          </option>
        ))}
      </select>

      <button onClick={handleGuardar}>Guardar</button>
      <button onClick={onClose}>Cancelar</button>
    </div>
  );
};

export default CursoEditarModal;